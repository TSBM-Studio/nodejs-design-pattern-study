# Chapter 11: ê³ ê¸‰ ë ˆì‹œí”¼

> **ë°œí‘œì**: ê¸¸í˜„ì¤€
> **ë°œí‘œì¼**: 2025-12-08
> **ì£¼ì œ**: ë¹„ë™ê¸° ì´ˆê¸°í™”, ìš”ì²­ ë°°ì¹˜/ìºì‹±, ì‘ì—… ì·¨ì†Œ, CPU ë°”ìš´ë“œ ì‹¤í–‰

---

## ğŸ“Œ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ë¹„ë™ê¸°ì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ ë‹¤ë£¨ê¸°](#1-ë¹„ë™ê¸°ì ìœ¼ë¡œ-ì´ˆê¸°í™”ë˜ëŠ”-ì»´í¬ë„ŒíŠ¸-ë‹¤ë£¨ê¸°)
3. [ë¹„ë™ê¸°ì‹ ìš”ì²­ ì¼ê´„ ì²˜ë¦¬ ë° ìºì‹±](#2-ë¹„ë™ê¸°ì‹-ìš”ì²­-ì¼ê´„-ì²˜ë¦¬-ë°-ìºì‹±)
4. [ë¹„ë™ê¸° ì‘ì—… ì·¨ì†Œ](#3-ë¹„ë™ê¸°-ì‘ì—…-ì·¨ì†Œ)
5. [CPU ë°”ìš´ë“œ ì‘ì—… ì‹¤í–‰](#4-cpu-ë°”ìš´ë“œ-ì‘ì—…-ì‹¤í–‰)
6. [ìš”ì•½](#ìš”ì•½)
7. [ì—°ìŠµë¬¸ì œ](#ì—°ìŠµë¬¸ì œ)

---

## ê°œìš”

### ì™œ ì¤‘ìš”í•œê°€?

Node.js ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ë‹¤ ë³´ë©´ ë‹¨ìˆœí•œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ë„˜ì–´ì„œëŠ” ê³ ê¸‰ ê¸°ë²•ì´ í•„ìš”í•œ ìƒí™©ì„ ìì£¼ ë§ˆì£¼í•©ë‹ˆë‹¤:

- **ë¹„ë™ê¸° ì´ˆê¸°í™”**: DB ì—°ê²°, ì„¤ì • ë¡œë“œ ë“± ë¹„ë™ê¸°ë¡œ ì´ˆê¸°í™”ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ì–´ë–»ê²Œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í• ê¹Œ?
- **ì¤‘ë³µ ìš”ì²­ ìµœì í™”**: ë™ì¼í•œ APIë¥¼ ë™ì‹œì— ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•  ë•Œ ì–´ë–»ê²Œ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í• ê¹Œ?
- **ì‘ì—… ì·¨ì†Œ**: ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ë– ë‚¬ëŠ”ë° ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì„ ì–´ë–»ê²Œ ì¤‘ë‹¨í• ê¹Œ?
- **CPU ì§‘ì•½ì  ì‘ì—…**: ë¬´ê±°ìš´ ê³„ì‚°ì´ ì„œë²„ ì‘ë‹µì„ ë§‰ëŠ” ê²ƒì„ ì–´ë–»ê²Œ ë°©ì§€í• ê¹Œ?

### í•µì‹¬ í‚¤ì›Œë“œ

| ê°œë… | ì„¤ëª… |
|------|------|
| **ì‚¬ì „ ì´ˆê¸°í™” í** | ì´ˆê¸°í™” ì™„ë£Œ ì „ ìš”ì²­ì„ íì— ì €ì¥í•˜ì—¬ ë‚˜ì¤‘ì— ì‹¤í–‰ |
| **ìš”ì²­ ë°°ì¹˜** | ë™ì¼í•œ ìš”ì²­ ì¤‘ë³µ ë°©ì§€ (í”¼ê¸°ë°±) |
| **ìš”ì²­ ìºì‹±** | ê²°ê³¼ë¥¼ ì €ì¥í•˜ì—¬ ì¬ì‚¬ìš© |
| **ì·¨ì†Œ í† í°** | ë¹„ë™ê¸° ì‘ì—…ì„ ì•ˆì „í•˜ê²Œ ì¤‘ë‹¨ |
| **ì‘ì—…ì í’€** | CPU ì‘ì—…ì„ ë³„ë„ í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ |

---

## 1. ë¹„ë™ê¸°ì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ ë‹¤ë£¨ê¸°

### ë¬¸ì œ ìƒí™©

```javascript
// âŒ ë¬¸ì œ: ì—°ê²° ì „ì— ì¿¼ë¦¬í•˜ë©´ ì—ëŸ¬ ë°œìƒ
const db = new DB()
db.connect()  // ë¹„ë™ê¸° ì´ˆê¸°í™” ì‹œì‘
db.query('SELECT * FROM users')  // Error: Not connected yet
```

### í•´ê²°ì±… ë¹„êµ

#### 1) ë¡œì»¬ ì´ˆê¸°í™” í™•ì¸

ë§¤ë²ˆ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ëŒ€ê¸°í•©ë‹ˆë‹¤.

```javascript
async function updateLastAccess() {
  // ë§¤ë²ˆ ì—°ê²° ìƒíƒœ í™•ì¸
  if (!db.connected) {
    await once(db, 'connected')
  }
  await db.query('INSERT INTO ...')
}
```

**ë‹¨ì **: ì½”ë“œ ì¤‘ë³µ, ëª¨ë“  í•¨ìˆ˜ì—ì„œ í™•ì¸ í•„ìš”

#### 2) ì§€ì—° ì‹œì‘

ëª¨ë“  ì´ˆê¸°í™”ê°€ ì™„ë£Œëœ í›„ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

```javascript
async function main() {
  // ë¨¼ì € ëª¨ë“  ì´ˆê¸°í™” ì™„ë£Œ ëŒ€ê¸°
  await initialize()

  // ì´í›„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
  startServer()
}
```

**ë‹¨ì **: ì‹œì‘ ì‹œê°„ ì§€ì—°, ì¬ì´ˆê¸°í™” ë¯¸ê³ ë ¤

#### 3) ì‚¬ì „ ì´ˆê¸°í™” í (ê¶Œì¥)

ì´ˆê¸°í™” ì „ ìš”ì²­ì„ íì— ì €ì¥í•˜ê³ , ì™„ë£Œ í›„ ì¼ê´„ ì‹¤í–‰í•©ë‹ˆë‹¤.

```javascript
async query(queryString) {
  if (!this.connected) {
    // ëª…ë ¹ì„ íì— ì €ì¥í•˜ê³  Promise ë°˜í™˜
    return new Promise((resolve, reject) => {
      this.commandsQueue.push(() => {
        this.query(queryString).then(resolve, reject)
      })
    })
  }
  // ì‹¤ì œ ì¿¼ë¦¬ ì‹¤í–‰
  return this._executeQuery(queryString)
}
```

### ìƒíƒœ íŒ¨í„´ìœ¼ë¡œ ê°œì„ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Client                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚          DB             â”‚
              â”‚    (Context)            â”‚
              â”‚                         â”‚
              â”‚  state.query(...)       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                 â”‚
           â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   QueuingState      â”‚         â”‚  InitializedState   â”‚
â”‚                     â”‚         â”‚                     â”‚
â”‚ - ìš”ì²­ì„ íì— ì €ì¥  â”‚ â”€â”€â”€â”€â”€â”€> â”‚ - ì‹¤ì œ ì¿¼ë¦¬ ì‹¤í–‰    â”‚
â”‚ - Promise ë°˜í™˜      â”‚ connect â”‚ - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‹¤ì „ ì˜ˆì‹œ**: Mongoose, pg ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì´ ë°©ì‹ ì‚¬ìš©

---

## 2. ë¹„ë™ê¸°ì‹ ìš”ì²­ ì¼ê´„ ì²˜ë¦¬ ë° ìºì‹±

### ìš”ì²­ ë°°ì¹˜ (Batching)

ë™ì¼í•œ API ìš”ì²­ì´ ì§„í–‰ ì¤‘ì¼ ë•Œ, ìƒˆ ìš”ì²­ì„ ì‹œì‘í•˜ì§€ ì•Šê³  ê¸°ì¡´ ìš”ì²­ì— **í”¼ê¸°ë°±(piggyback)** í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Without Batching                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Client A â”€â”€â†’ [API Call] â”€â”€â†’ Result A                   â”‚
â”‚  Client B â”€â”€â†’ [API Call] â”€â”€â†’ Result B                   â”‚
â”‚  Client C â”€â”€â†’ [API Call] â”€â”€â†’ Result C                   â”‚
â”‚                                                          â”‚
â”‚  â†’ 3ë²ˆì˜ API í˜¸ì¶œ, 3ë°°ì˜ ì‹œê°„                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       With Batching                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Client A â”€â”                                            â”‚
â”‚            â”œâ”€â”€â†’ [API Call] â”€â”€â†’ Result (ê³µìœ )            â”‚
â”‚  Client B â”€â”¤                     â†“                      â”‚
â”‚            â”‚                   A, B, C ëª¨ë‘ ë™ì¼ ê²°ê³¼    â”‚
â”‚  Client C â”€â”˜                                            â”‚
â”‚                                                          â”‚
â”‚  â†’ 1ë²ˆì˜ API í˜¸ì¶œ, 1/3 ì‹œê°„                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
function createBatchedApi(originalApi) {
  const runningRequests = new Map()

  return async function(key) {
    // ë™ì¼í•œ ìš”ì²­ì´ ì§„í–‰ ì¤‘ì´ë©´ í•´ë‹¹ Promise ë°˜í™˜
    if (runningRequests.has(key)) {
      return runningRequests.get(key)
    }

    // ìƒˆ ìš”ì²­ ì‹œì‘
    const resultPromise = originalApi(key)
    runningRequests.set(key, resultPromise)

    resultPromise.finally(() => {
      runningRequests.delete(key)
    })

    return resultPromise
  }
}
```

### ìš”ì²­ ìºì‹± (Caching)

ë°°ì¹˜ ì²˜ë¦¬ì— **TTL(Time To Live)** ê¸°ë°˜ ìºì‹œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```javascript
function createCachedApi(originalApi, ttlMs = 5000) {
  const cache = new Map()
  const runningRequests = new Map()

  return async function(key) {
    // 1. ìºì‹œ í™•ì¸
    const cached = cache.get(key)
    if (cached && (Date.now() - cached.timestamp) < ttlMs) {
      return cached.value  // Cache HIT
    }

    // 2. ë°°ì¹˜ í™•ì¸
    if (runningRequests.has(key)) {
      return runningRequests.get(key)
    }

    // 3. ìƒˆ ìš”ì²­
    const resultPromise = originalApi(key)
    runningRequests.set(key, resultPromise)

    const result = await resultPromise
    cache.set(key, { value: result, timestamp: Date.now() })
    runningRequests.delete(key)

    return result
  }
}
```

### ìºì‹± ê³ ë ¤ì‚¬í•­

| ê³ ë ¤ì‚¬í•­ | ì„¤ëª… |
|----------|------|
| **TTL ì„¤ì •** | ë°ì´í„° íŠ¹ì„±ì— ë§ëŠ” ì ì ˆí•œ ë§Œë£Œ ì‹œê°„ |
| **ë©”ëª¨ë¦¬ ê´€ë¦¬** | LRU ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì˜¤ë˜ëœ í•­ëª© ì œê±° |
| **ë¬´íš¨í™” ì „ëµ** | ë°ì´í„° ë³€ê²½ ì‹œ ìºì‹œ ë™ê¸°í™” |
| **ë¶„ì‚° ìºì‹œ** | ì—¬ëŸ¬ ì„œë²„ ê°„ ìºì‹œ ê³µìœ  (Redis ë“±) |

---

## 3. ë¹„ë™ê¸° ì‘ì—… ì·¨ì†Œ

### ê¸°ë³¸ íŒ¨í„´: cancelRequested í”Œë˜ê·¸

```javascript
async function cancellableOperation(cancelObj) {
  const res1 = await asyncStep('Step 1')
  if (cancelObj.cancelRequested) {
    throw new CancelError()
  }

  const res2 = await asyncStep('Step 2')
  if (cancelObj.cancelRequested) {
    throw new CancelError()
  }

  return [res1, res2]
}

// ì‚¬ìš©
const cancelObj = { cancelRequested: false }
const promise = cancellableOperation(cancelObj)

setTimeout(() => {
  cancelObj.cancelRequested = true  // ì·¨ì†Œ ìš”ì²­
}, 500)
```

### ë˜í¼ íŒ¨í„´

```javascript
function createCancelWrapper() {
  let cancelRequested = false

  return {
    cancel: () => { cancelRequested = true },
    cancelWrapper: (asyncFn, ...args) => {
      if (cancelRequested) {
        return Promise.reject(new CancelError())
      }
      return asyncFn(...args)
    }
  }
}
```

### ì œë„ˆë ˆì´í„° íŒ¨í„´ (ê¶Œì¥)

```javascript
const cancellableOperation = createAsyncCancelable(function* () {
  // ê° yieldê°€ ìë™ìœ¼ë¡œ ì·¨ì†Œ í¬ì¸íŠ¸
  const resA = yield asyncStep('Step A')
  const resB = yield asyncStep('Step B')
  const resC = yield asyncStep('Step C')
  return [resA, resB, resC]
})

// ì‚¬ìš©
const { promise, cancel } = cancellableOperation()
setTimeout(cancel, 500)  // 500ms í›„ ì·¨ì†Œ
await promise
```

**ì°¸ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬**: [caf](https://github.com/getify/CAF)

---

## 4. CPU ë°”ìš´ë“œ ì‘ì—… ì‹¤í–‰

### ë¬¸ì œ: ì´ë²¤íŠ¸ ë£¨í”„ ì°¨ë‹¨

```javascript
// âŒ ë¬´ê±°ìš´ ë™ê¸° ê³„ì‚° - ì„œë²„ê°€ ì‘ë‹µ ë¶ˆê°€
function heavyComputation(data) {
  // O(2^n) ì‹œê°„ ë³µì¡ë„...
  for (let i = 0; i < 1e10; i++) { /* ... */ }
}
```

### í•´ê²°ì±… ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Main Thread                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Request â”‚  â”‚ Request â”‚  â”‚ Request â”‚  â”‚ Request â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚            â”‚            â”‚            â”‚                  â”‚
â”‚       â–¼            â–¼            â–¼            â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚              Event Loop (Non-Blocking)            â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                            â”‚                                    â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚       â–¼                    â–¼                    â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚Worker 1 â”‚          â”‚Worker 2 â”‚          â”‚Worker 3 â”‚        â”‚
â”‚  â”‚(Thread) â”‚          â”‚(Thread) â”‚          â”‚(Process)â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1) setImmediate ì¸í„°ë¦¬ë¹™

```javascript
// ê³„ì‚° ë‹¨ê³„ ì‚¬ì´ì— ì´ë²¤íŠ¸ ë£¨í”„ì— ì–‘ë³´
function* compute() {
  for (let i = 0; i < items.length; i++) {
    yield processItem(items[i])  // ê° ë‹¨ê³„ í›„ ì–‘ë³´
  }
}
```

**ì¥ì **: ì¶”ê°€ ë¦¬ì†ŒìŠ¤ ë¶ˆí•„ìš”
**ë‹¨ì **: ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ, ë‹¨ì¼ ì½”ì–´ë§Œ ì‚¬ìš©

#### 2) ì™¸ë¶€ í”„ë¡œì„¸ìŠ¤ (child_process.fork)

```javascript
const pool = new ProcessPool('./worker.js', 4)
const result = await pool.run({ set, sum })
```

**ì¥ì **: ë©€í‹°ì½”ì–´ í™œìš©, í¬ë˜ì‹œ ê²©ë¦¬
**ë‹¨ì **: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰, ì‹œì‘ ë¹„ìš©

#### 3) ì‘ì—…ì ìŠ¤ë ˆë“œ (worker_threads)

```javascript
const pool = new ThreadPool(4)
const result = await pool.run({ set, sum })
```

**ì¥ì **: í”„ë¡œì„¸ìŠ¤ë³´ë‹¤ ê°€ë²¼ì›€, SharedArrayBuffer ì§€ì›
**ë‹¨ì **: Node 10.5+ í•„ìš”

### ë¹„êµí‘œ

| ë°©ë²• | ì´ë²¤íŠ¸ ë£¨í”„ | ë©€í‹°ì½”ì–´ | ì˜¤ë²„í—¤ë“œ | ì í•©í•œ ê²½ìš° |
|------|-------------|----------|----------|-------------|
| setImmediate | ê³µìœ  | âŒ | ë‚®ìŒ | ì§§ì€ ë‹¨ê³„ë¡œ ë¶„í•  ê°€ëŠ¥í•œ ì‘ì—… |
| child_process | ë¶„ë¦¬ | âœ… | ë†’ìŒ | ì¥ì‹œê°„ ì‹¤í–‰, ê²©ë¦¬ í•„ìš” |
| worker_threads | ë¶„ë¦¬ | âœ… | ì¤‘ê°„ | ë¹ˆë²ˆí•œ CPU ì‘ì—…, ë©”ëª¨ë¦¬ ê³µìœ  |

**ê¶Œì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬**:
- [workerpool](https://github.com/josdejong/workerpool)
- [piscina](https://github.com/piscinajs/piscina)

---

## ìš”ì•½

| íŒ¨í„´ | ë¬¸ì œ ìƒí™© | í•´ê²° ë°©ë²• | ì‹¤ì „ ì˜ˆì‹œ |
|------|----------|----------|----------|
| **ì‚¬ì „ ì´ˆê¸°í™” í** | ë¹„ë™ê¸° ì´ˆê¸°í™” ì „ API í˜¸ì¶œ | ìš”ì²­ì„ íì— ì €ì¥ í›„ ë‚˜ì¤‘ì— ì‹¤í–‰ | Mongoose, pg |
| **ìš”ì²­ ë°°ì¹˜** | ë™ì¼ API ì¤‘ë³µ í˜¸ì¶œ | runningRequests Mapìœ¼ë¡œ í”¼ê¸°ë°± | API Gateway |
| **ìš”ì²­ ìºì‹±** | ë°˜ë³µì ì¸ ë™ì¼ ìš”ì²­ | TTL ê¸°ë°˜ ìºì‹œ + ë°°ì¹˜ | Redis ìºì‹œ |
| **ì‘ì—… ì·¨ì†Œ** | ë¶ˆí•„ìš”í•´ì§„ ì§„í–‰ ì¤‘ ì‘ì—… | cancelWrapper, ì œë„ˆë ˆì´í„° | caf |
| **CPU ë°”ìš´ë“œ** | ì´ë²¤íŠ¸ ë£¨í”„ ì°¨ë‹¨ | í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œ í’€ | piscina |

---

## ì—°ìŠµë¬¸ì œ

### 11.1 í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•œ ëŒ€ê¸°ì—´ êµ¬í˜„

Proxyë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸°ë¡œ ì´ˆê¸°í™”ë˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— ëŒ€ê¸°ì—´ì„ íˆ¬ëª…í•˜ê²Œ ì ìš©í•˜ëŠ” ì¼ë°˜ ë˜í¼ ë§Œë“¤ê¸°.

### 11.2 ì½œë°± ê¸°ë°˜ ë°°ì¹˜ ë° ìºì‹±

Promise ì—†ì´ ì½œë°± ë°©ì‹ìœ¼ë¡œ ìš”ì²­ ë°°ì¹˜ ë° ìºì‹± êµ¬í˜„í•˜ê¸°.

### 11.3 Deep ì·¨ì†Œ ê°€ëŠ¥í•œ ë¹„ë™ê¸° í•¨ìˆ˜

ì¤‘ì²©ëœ ì·¨ì†Œ ê°€ëŠ¥ í•¨ìˆ˜ì—ì„œ ë£¨íŠ¸ í•¨ìˆ˜ ì·¨ì†Œ ì‹œ ëª¨ë“  ì¤‘ì²© í•¨ìˆ˜ê¹Œì§€ ì·¨ì†Œë˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°.

### 11.4 ì»´í“¨íŒ… íŒœ

HTTPë¡œ ì‘ì—…ì„ ë¶„ì‚°í•˜ê³  eval/vmìœ¼ë¡œ ë™ì  ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë¶„ì‚° ì»´í“¨íŒ… ì‹œìŠ¤í…œ êµ¬í˜„í•˜ê¸°.

---

## ì°¸ê³  ìë£Œ

### ë¼ì´ë¸ŒëŸ¬ë¦¬

- [Mongoose](https://mongoosejs.com/) - ì‚¬ì „ ì´ˆê¸°í™” í ì‚¬ìš©
- [pg](https://node-postgres.com/) - PostgreSQL í´ë¼ì´ì–¸íŠ¸
- [caf](https://github.com/getify/CAF) - ì·¨ì†Œ ê°€ëŠ¥í•œ ë¹„ë™ê¸° í•¨ìˆ˜
- [workerpool](https://github.com/josdejong/workerpool) - í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œ í’€
- [piscina](https://github.com/piscinajs/piscina) - ì‘ì—…ì ìŠ¤ë ˆë“œ í’€

### ê³µì‹ ë¬¸ì„œ

- [child_process](https://nodejs.org/api/child_process.html)
- [worker_threads](https://nodejs.org/api/worker_threads.html)
- [SharedArrayBuffer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer)
